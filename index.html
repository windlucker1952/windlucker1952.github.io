<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Time2Race Timer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#0b0f14;
      --card:#0f1720;
      --muted:#9aa4b2;
      --text:#e6eef6;
      --accent:#60a5fa;
      --border:#1f2933;
      --input:#11151a;
      --btn:#1b2430;
      --danger-bg:#ffcccc; /* used when <10 min as requested */
    }
    html,body{height:100%}
    body {
      margin:0;
      font-family: Inter, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, #051018 0%, var(--bg) 100%);
      color:var(--text);
      padding:18px;
    }
    h2 { margin:0 0 8px 0; color:var(--text); }
    p { margin:0 0 16px 0; color:var(--muted); }

    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap:12px; }

    .timer {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 6px 18px rgba(2,6,23,0.6);
      transition: background-color 0.25s ease, box-shadow 0.25s ease, transform 0.12s ease;
      color:var(--text);
    }
    .timer:active{ transform: translateY(1px); }

    .display { font-size: 18px; font-weight:700; margin-bottom:6px; color:var(--text); }
    .remaining { color:var(--text); margin-bottom:8px; font-size:25px; }

    .controls { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:8px; align-items:center; }
    .controls > * { font-size:13px; }

    .small-input {
      width: 120px;
      padding:7px 8px;
      border-radius:6px;
      border:1px solid rgba(255,255,255,0.03);
      background:var(--input);
      color:var(--text);
      outline:none;
    }
    .small-input[type="number"]::-webkit-outer-spin-button,
    .small-input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

    button {
      padding:7px 9px;
      border-radius:6px;
      border:1px solid rgba(255,255,255,0.04);
      background:var(--btn);
      color:var(--text);
      cursor:pointer;
      transition: background 0.12s ease, transform 0.06s ease;
    }
    button:hover{ filter:brightness(1.05) }
    button:active{ transform: translateY(1px) }
    button:disabled{ opacity:0.45; cursor:not-allowed; }

    .progress { height:8px; background: rgba(255,255,255,0.03); border-radius:6px; overflow:hidden; margin-top:8px; }
    .bar { height:100%; background: var(--accent); width:100%; transition: width 0.2s linear; }

    .meta { font-size:12px; color:var(--muted); margin-top:6px; }
    /* make the danger background visually distinct on dark theme: add subtle red overlay */
    .danger-overlay {
      box-shadow: inset 0 0 0 9999px rgba(255,50,50,0.9);
    }

    /* responsive tweaks */
    @media (max-width:420px){
      .small-input{ width: 100%; }
      .controls{ gap:6px; }
    }
  </style>
</head>
<body>
  <h2>Таймеры (тёмная тема)</h2>
  <p>Добавьте минуты или нажмите "+1 hour" — затем Start. Pause/Reset доступны.</p>

  <div class="grid" id="timersRoot"></div>

<script>
(function(){
  const COUNT = 20;
  const root = document.getElementById('timersRoot');

  for(let i=0;i<COUNT;i++){
    createTimerBlock(i+1);
  }

  function createTimerBlock(id){
    const el = document.createElement('div');
    el.className = 'timer';
    el.setAttribute('data-id', String(id));

    const title = document.createElement('div');
    title.className = 'display';
    title.textContent = 'Cockpit #' + id;

    const remaining = document.createElement('div');
    remaining.className = 'remaining';
    remaining.textContent = ' 00:00:00';

    // inputs: minutes adder only (date removed)
    const minsInput = document.createElement('input');
    minsInput.type = 'number';
    minsInput.min = '0';
    minsInput.step = '1';
    minsInput.placeholder = 'Минуты';
    minsInput.className = 'small-input';

    const addMinsBtn = document.createElement('button');
    addMinsBtn.textContent = 'Add Minutes';

    const addHourBtn = document.createElement('button');
    addHourBtn.textContent = '+1 hour';

    // controls: Start, Pause, Reset
    const startBtn = document.createElement('button');
    startBtn.textContent = 'Start';
    const pauseBtn = document.createElement('button');
    pauseBtn.textContent = 'Pause';
    const resetBtn = document.createElement('button');
    resetBtn.textContent = 'Reset';

    const controls = document.createElement('div');
    controls.className = 'controls';
    controls.appendChild(minsInput);
    controls.appendChild(addMinsBtn);
    controls.appendChild(addHourBtn);
    controls.appendChild(startBtn);
    controls.appendChild(pauseBtn);
    controls.appendChild(resetBtn);

    const progress = document.createElement('div');
    progress.className = 'progress';
    const bar = document.createElement('div');
    bar.className = 'bar';
    progress.appendChild(bar);

    const meta = document.createElement('div');
    meta.className = 'meta';
   

    el.appendChild(title);
    el.appendChild(remaining);
    el.appendChild(controls);
    el.appendChild(progress);
    el.appendChild(meta);
    root.appendChild(el);

    // state
    const state = {
      totalMs: 0,
      endAt: null,
      running: false,
      paused: false,
      pauseRemaining: 0,
      ticker: null
    };

    // утилиты
    function msToHMS(ms){
      const s = Math.max(0, Math.floor(ms/1000));
      const hh = String(Math.floor(s/3600)).padStart(2,'0');
      const mm = String(Math.floor((s%3600)/60)).padStart(2,'0');
      const ss = String(s%60).padStart(2,'0');
      return {str: hh+':'+mm+':'+ss, seconds: s};
    }

    function updateUI(){
      const remainingMs = state.running && state.endAt ? Math.max(0, state.endAt - Date.now()) : (state.paused ? state.pauseRemaining : state.pauseRemaining);
      const displayStr = msToHMS(remainingMs).str;
      remaining.textContent = displayStr;

      // прогресс: если totalMs == 0, сделать full (100%)
      const total = state.totalMs > 0 ? state.totalMs : (state.pauseRemaining > 0 ? state.pauseRemaining : 1);
      const pct = total > 0 ? (remainingMs / total) * 100 : 0;
      bar.style.width = pct + '%';

      // фон красный, если осталось меньше 10 минут (и ещё >0)
      if(remainingMs > 0 && remainingMs < 10 * 60 * 1000){
        // применяем тонкую красную заливку поверх карточки
        el.style.background = 'linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))';
        el.classList.add('danger-overlay');
      } else {
        el.classList.remove('danger-overlay');
        el.style.background = 'linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))';
      }

      startBtn.disabled = state.running;
      pauseBtn.disabled = !state.running;
    }

    function startTicker(){
      if(state.ticker) return;
      state.ticker = setInterval(()=>{
        if(state.running && state.endAt && Date.now() >= state.endAt){
          // завершение
          state.running = false;
          state.paused = false;
          state.pauseRemaining = 0;
          state.endAt = null;
          clearInterval(state.ticker);
          state.ticker = null;
        }
        updateUI();
      }, 200);
    }
    function stopTicker(){
      if(state.ticker){ clearInterval(state.ticker); state.ticker = null; }
    }

    // Add minutes
    addMinsBtn.addEventListener('click', ()=>{
      const mins = Math.max(0, parseInt(minsInput.value || 0, 10) || 0);
      const addMs = mins * 60 * 1000;
      state.totalMs = Math.max(0, state.totalMs + addMs);
      if(state.running && state.endAt){
        state.endAt += addMs;
      } else if(state.paused){
        state.pauseRemaining = Math.max(0, state.pauseRemaining + addMs);
      } else {
        state.pauseRemaining = Math.max(0, state.pauseRemaining + addMs);
      }
      updateUI();
    });

    // +1 hour button
    addHourBtn.addEventListener('click', ()=>{
      const addMs = 3600 * 1000;
      state.totalMs = Math.max(0, state.totalMs + addMs);
      if(state.running && state.endAt){
        state.endAt += addMs;
      } else if(state.paused){
        state.pauseRemaining = Math.max(0, state.pauseRemaining + addMs);
      } else {
        state.pauseRemaining = Math.max(0, state.pauseRemaining + addMs);
      }
      updateUI();
    });

    // Start
    startBtn.addEventListener('click', ()=>{
      if(state.totalMs <= 0 && state.pauseRemaining <= 0){
        state.totalMs = 60 * 1000;
        state.pauseRemaining = state.totalMs;
      }
      if(state.paused && state.pauseRemaining > 0){
        state.endAt = Date.now() + state.pauseRemaining;
        state.paused = false;
        state.running = true;
      } else if(!state.running){
        const startRemaining = state.pauseRemaining > 0 ? state.pauseRemaining : state.totalMs;
        state.endAt = Date.now() + startRemaining;
        if(state.totalMs === 0) state.totalMs = startRemaining;
        state.running = true;
        state.paused = false;
      }
      startTicker();
      updateUI();
    });

    // Pause
    pauseBtn.addEventListener('click', ()=>{
      if(!state.running) return;
      state.pauseRemaining = Math.max(0, state.endAt - Date.now());
      state.paused = true;
      state.running = false;
      state.endAt = null;
      stopTicker();
      updateUI();
    });

    // Reset
    resetBtn.addEventListener('click', ()=>{
      state.totalMs = 0;
      state.endAt = null;
      state.running = false;
      state.paused = false;
      state.pauseRemaining = 0;
      stopTicker();
      updateUI();
    });

    // Enter on minutes input
    minsInput.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter') addMinsBtn.click();
    });

    // initialize UI
    updateUI();
  }

  // синхронизируем UI при видимости страницы
  document.addEventListener('visibilitychange', ()=>{
    if(document.visibilityState === 'visible'){
      // ничего дополнительного не требуется — таймеры обновятся на следующем тике
    }
  });

})();
</script>
</body>
</html>

